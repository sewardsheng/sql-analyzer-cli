### SQL Analyzer API 完整测试文件
### 包含所有API接口的测试用例
### 使用 REST Client 或 Postman 进行测试

@baseUrl = http://localhost:3000
@contentType = application/json
@authToken = Bearer your-api-key-here

### ========================================
### 文件说明和使用指南
### ========================================

# 本测试文件包含以下测试类别：
# 1. 基础功能测试 - 验证所有接口的基本功能
# 2. 参数验证测试 - 测试边界值、特殊字符、异常参数
# 3. 错误处理测试 - 验证各种错误场景的处理
# 4. 性能测试 - 测试大数据量、复杂查询场景
# 5. 安全测试 - SQL注入、XSS等安全漏洞测试
# 6. 集成场景测试 - 完整工作流程测试

# 使用方法：
# 1. 确保SQL Analyzer API服务已启动 (npm start 或 node src/server.js)
# 2. 在VS Code中安装REST Client扩展
# 3. 点击请求上方的"Send Request"按钮执行测试
# 4. 查看响应结果验证接口功能

# 注意事项：
# - 某些测试需要替换实际的ID值（如历史记录ID）
# - 性能测试可能需要较长时间，请耐心等待
# - 安全测试包含恶意SQL，请在测试环境中执行

### ========================================
### 1. 基础功能测试
### ========================================

### 1.1 系统信息接口

### GET / - API根路径
GET {{baseUrl}}/

### GET /api/docs - API文档
GET {{baseUrl}}/api/docs

### 1.2 健康检查接口

### GET /api/health - 系统健康检查
GET {{baseUrl}}/api/health

### GET /api/health/ping - 简单ping检查
GET {{baseUrl}}/api/health/ping

### GET /api/health/status - 服务状态信息
GET {{baseUrl}}/api/health/status

### GET /api/health/check/:type - 特定类型健康检查 (内存检查)
GET {{baseUrl}}/api/health/check/memory

### GET /api/health/check/:type - 特定类型健康检查 (CPU检查)
GET {{baseUrl}}/api/health/check/cpu-usage

### GET /api/health/check/:type - 特定类型健康检查 (磁盘空间检查)
GET {{baseUrl}}/api/health/check/disk-space

### 1.3 SQL分析接口

### POST /api/analyze - 单条SQL分析 (简单查询)
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT * FROM users WHERE id = 1",
  "options": {
    "performance": true,
    "security": true,
    "standards": true,
    "learn": false
  }
}

### POST /api/analyze - 单条SQL分析 (复杂查询)
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT u.*, o.order_id, o.total_amount FROM users u LEFT JOIN orders o ON u.id = o.user_id WHERE u.status = 'active' AND o.created_at >= '2025-01-01' ORDER BY u.created_at DESC LIMIT 100",
  "options": {
    "performance": true,
    "security": true,
    "standards": true,
    "learn": false
  }
}

### POST /api/analyze/batch - 批量SQL分析
POST {{baseUrl}}/api/analyze/batch
Content-Type: {{contentType}}

{
  "sqls": [
    {
      "sql": "SELECT * FROM users WHERE id = 1"
    },
    {
      "sql": "SELECT COUNT(*) FROM orders WHERE status = 'pending'"
    },
    {
      "sql": "UPDATE users SET last_login = NOW() WHERE id = 1"
    }
  ],
  "options": {
    "performance": true,
    "security": true,
    "standards": true,
    "learn": false
  }
}

### 1.4 历史记录接口

### GET /api/history - 获取历史记录列表
GET {{baseUrl}}/api/history

### GET /api/history/stats - 获取历史记录统计
GET {{baseUrl}}/api/history/stats

### GET /api/history/:id - 获取指定历史记录详情 (需要替换实际ID)
GET {{baseUrl}}/api/history/1731758400000-abc123

### POST /api/history/search - 搜索历史记录
POST {{baseUrl}}/api/history/search
Content-Type: {{contentType}}

{
  "sql": "SELECT",
  "database": "mysql",
  "dateFrom": "2025-01-01",
  "dateTo": "2025-12-31",
  "limit": 10
}

### GET /api/history/export - 导出历史记录 (JSON格式)
GET {{baseUrl}}/api/history/export?format=json

### GET /api/history/export - 导出历史记录 (CSV格式)
GET {{baseUrl}}/api/history/export?format=csv

### DELETE /api/history/:id - 删除指定历史记录 (需要替换实际ID)
DELETE {{baseUrl}}/api/history/1731758400000-abc123

### DELETE /api/history - 清空所有历史记录
DELETE {{baseUrl}}/api/history

### 1.5 知识库接口

### GET /api/knowledge - 获取知识库状态
GET {{baseUrl}}/api/knowledge

### POST /api/knowledge/search - 搜索知识库
POST {{baseUrl}}/api/knowledge/search
Content-Type: {{contentType}}

{
  "query": "SQL注入",
  "k": 5
}

### POST /api/knowledge/learn - 学习新文档
POST {{baseUrl}}/api/knowledge/learn
Content-Type: {{contentType}}

{
  "rulesDir": "./rules",
  "reset": false,
  "priorityApproved": false
}

### POST /api/knowledge/reset - 重置知识库
POST {{baseUrl}}/api/knowledge/reset

### GET /api/knowledge/export - 导出知识库 (JSON格式)
GET {{baseUrl}}/api/knowledge/export?format=json&includeContent=false

### GET /api/knowledge/export - 导出知识库 (CSV格式，包含内容)
GET {{baseUrl}}/api/knowledge/export?format=csv&includeContent=true

### POST /api/knowledge/evaluate - 评估规则质量
POST {{baseUrl}}/api/knowledge/evaluate
Content-Type: {{contentType}}

{
  "report": true,
  "rulesDir": "./rules/learning-rules"
}

### POST /api/knowledge/cleanup - 清理低质量规则
POST {{baseUrl}}/api/knowledge/cleanup
Content-Type: {{contentType}}

{
  "score": 60,
  "backup": true,
  "rulesDir": "./rules/learning-rules"
}

### 1.6 配置管理接口

### GET /api/config - 获取所有配置
GET {{baseUrl}}/api/config

### GET /api/config/list - 获取配置项列表
GET {{baseUrl}}/api/config/list

### GET /api/config/:key - 获取指定配置项
GET {{baseUrl}}/api/config/model

### PUT /api/config/:key - 设置配置项
PUT {{baseUrl}}/api/config/model
Content-Type: {{contentType}}

{
  "value": "gpt-4"
}

### DELETE /api/config/:key - 删除配置项(恢复默认值)
DELETE {{baseUrl}}/api/config/model

### POST /api/config/reset - 重置所有配置
POST {{baseUrl}}/api/config/reset

### 1.7 系统状态接口

### GET /api/status - 获取系统状态
GET {{baseUrl}}/api/status

### GET /api/status?interactive=true - 获取系统状态(交互式格式)
GET {{baseUrl}}/api/status?interactive=true

### GET /api/status/health - 健康检查(简化版)
GET {{baseUrl}}/api/status/health

### GET /api/status/knowledge - 获取知识库状态
GET {{baseUrl}}/api/status/knowledge

### GET /api/status/history - 获取历史记录状态
GET {{baseUrl}}/api/status/history

### 1.8 初始化接口

### POST /api/init - 初始化系统
POST {{baseUrl}}/api/init
Content-Type: {{contentType}}

{
  "force": false,
  "config": {
    "knowledgeBase": {
      "enabled": true
    }
  }
}

### GET /api/init/status - 获取初始化状态
GET {{baseUrl}}/api/init/status

### POST /api/init/directories - 创建目录结构
POST {{baseUrl}}/api/init/directories

### POST /api/init/config - 初始化配置文件
POST {{baseUrl}}/api/init/config
Content-Type: {{contentType}}

{
  "config": {
    "knowledgeBase": {
      "enabled": true
    }
  }
}

### ========================================
### 2. 参数验证测试
### ========================================

### 2.1 SQL分析参数验证

### 测试空SQL语句
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "",
  "options": {
    "performance": true,
    "security": true,
    "standards": true
  }
}

### 测试缺少必需字段
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "query": "SELECT * FROM users"
}

### 测试无效的选项参数
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT * FROM users",
  "options": {
    "performance": "invalid",
    "security": 123,
    "standards": null
  }
}

### 测试超长SQL语句
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT * FROM users WHERE name = '" + "a".repeat(10000) + "'",
  "options": {
    "performance": true,
    "security": true,
    "standards": true
  }
}

### 测试批量分析空数组
POST {{baseUrl}}/api/analyze/batch
Content-Type: {{contentType}}

{
  "sqls": [],
  "options": {
    "performance": true,
    "security": true,
    "standards": true
  }
}

### 测试批量分析超过限制
POST {{baseUrl}}/api/analyze/batch
Content-Type: {{contentType}}

{
  "sqls": [
    {"sql": "SELECT * FROM users"}
  ],
  "options": {
    "performance": true,
    "security": true,
    "standards": true
  }
}

### 2.2 历史记录参数验证

### 测试无效的历史记录ID
GET {{baseUrl}}/api/history/invalid-id

### 测试历史记录搜索无效参数
POST {{baseUrl}}/api/history/search
Content-Type: {{contentType}}

{
  "sql": "",
  "database": "",
  "dateFrom": "invalid-date",
  "dateTo": "invalid-date",
  "limit": -1
}

### 测试导出无效格式
GET {{baseUrl}}/api/history/export?format=xml

### 2.3 知识库参数验证

### 测试知识库搜索空查询
POST {{baseUrl}}/api/knowledge/search
Content-Type: {{contentType}}

{
  "query": "",
  "k": 5
}

### 测试知识库搜索无效参数
POST {{baseUrl}}/api/knowledge/search
Content-Type: {{contentType}}

{
  "query": 123,
  "k": -1
}

### 测试知识库导出无效格式
GET {{baseUrl}}/api/knowledge/export?format=xml

### 测试知识库清理接口
POST {{baseUrl}}/api/knowledge/cleanup
Content-Type: {{contentType}}

{
  "score": 60,
  "backup": true,
  "rulesDir": "./rules/learning-rules"
}

### 测试知识库评估接口
POST {{baseUrl}}/api/knowledge/evaluate
Content-Type: {{contentType}}

{
  "report": true,
  "rulesDir": "./rules/learning-rules"
}

### 2.4 配置管理参数验证

### 测试设置无效配置值
PUT {{baseUrl}}/api/config/invalid-key
Content-Type: {{contentType}}

{
  "value": null
}

### 测试获取不存在的配置
GET {{baseUrl}}/api/config/nonexistent-key

### 测试初始化状态接口
GET {{baseUrl}}/api/init/status

### 测试系统状态接口
GET {{baseUrl}}/api/status

### 测试系统状态接口(交互式格式)
GET {{baseUrl}}/api/status?interactive=true

### 测试状态健康检查接口
GET {{baseUrl}}/api/status/health

### 测试知识库状态接口
GET {{baseUrl}}/api/status/knowledge

### 测试历史记录状态接口
GET {{baseUrl}}/api/status/history

### ========================================
### 3. 错误处理测试
### ========================================

### 3.1 HTTP错误状态码测试

### 测试404错误 - 访问不存在的端点
GET {{baseUrl}}/api/nonexistent

### 测试405错误 - 使用错误的HTTP方法
POST {{baseUrl}}/api/health

### 测试415错误 - 错误的内容类型
POST {{baseUrl}}/api/analyze
Content-Type: text/plain

{
  "sql": "SELECT * FROM users"
}

### 测试429错误 - 请求频率超限 (快速连续请求)
GET {{baseUrl}}/api/health

GET {{baseUrl}}/api/health

GET {{baseUrl}}/api/health

GET {{baseUrl}}/api/health

GET {{baseUrl}}/api/health

### 3.2 业务逻辑错误测试

### 测试SQL语法错误
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELCT * FORM users",
  "options": {
    "performance": true,
    "security": true,
    "standards": true
  }
}

### 测试删除不存在的历史记录
DELETE {{baseUrl}}/api/history/nonexistent-id

### 测试重置不存在的配置
DELETE {{baseUrl}}/api/config/nonexistent-key

### 测试无效的JSON请求体
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT * FROM users",
  "options": {
    "performance": true,
    "security": true,
    "standards": true
  }
// 无效的JSON语法 - 缺少闭合括号

### 测试初始化目录创建失败
POST {{baseUrl}}/api/init/directories

### 测试初始化配置文件失败
POST {{baseUrl}}/api/init/config
Content-Type: {{contentType}}

{
  "invalid": "config"
}

### ========================================
### 4. 性能测试
### ========================================

### 4.1 大数据量测试

### 测试复杂JOIN查询性能
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT u.id, u.name, u.email, COUNT(o.id) as order_count, SUM(o.total_amount) as total_spent FROM users u LEFT JOIN orders o ON u.id = o.user_id LEFT JOIN order_items oi ON o.id = oi.order_id LEFT JOIN products p ON oi.product_id = p.id WHERE u.created_at >= '2025-01-01' AND o.status IN ('completed', 'shipped') GROUP BY u.id, u.name, u.email HAVING COUNT(o.id) > 5 ORDER BY total_spent DESC LIMIT 100",
  "options": {
    "performance": true,
    "security": true,
    "standards": true
  }
}

### 测试批量分析性能 (10条SQL)
POST {{baseUrl}}/api/analyze/batch
Content-Type: {{contentType}}

{
  "sqls": [
    {"sql": "SELECT * FROM users WHERE id = 1"},
    {"sql": "SELECT * FROM users WHERE id = 2"},
    {"sql": "SELECT * FROM users WHERE id = 3"},
    {"sql": "SELECT * FROM users WHERE id = 4"},
    {"sql": "SELECT * FROM users WHERE id = 5"},
    {"sql": "SELECT * FROM users WHERE id = 6"},
    {"sql": "SELECT * FROM users WHERE id = 7"},
    {"sql": "SELECT * FROM users WHERE id = 8"},
    {"sql": "SELECT * FROM users WHERE id = 9"},
    {"sql": "SELECT * FROM users WHERE id = 10"}
  ],
  "options": {
    "performance": true,
    "security": true,
    "standards": true
  }
}

### 测试超长SQL语句性能
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT " + "column" + ", ".repeat(100) + " FROM table1 t1 INNER JOIN table2 t2 ON t1.id = t2.id INNER JOIN table3 t3 ON t2.id = t3.id WHERE " + "t1.field = 'value' AND ".repeat(50) + "t1.status = 'active'",
  "options": {
    "performance": true,
    "security": true,
    "standards": true
  }
}

### 4.2 并发性能测试

### 测试知识库搜索性能 (复杂查询)
POST {{baseUrl}}/api/knowledge/search
Content-Type: {{contentType}}

{
  "query": "数据库性能优化 索引设计 查询优化 SQL调优 慢查询分析 执行计划",
  "k": 10
}

### 测试历史记录搜索性能
POST {{baseUrl}}/api/history/search
Content-Type: {{contentType}}

{
  "sql": "SELECT UPDATE INSERT DELETE CREATE DROP ALTER",
  "database": "mysql",
  "dateFrom": "2025-01-01",
  "dateTo": "2025-12-31",
  "limit": 100
}

### ========================================
### 5. 安全测试
### ========================================

### 5.1 SQL注入测试

### 测试经典SQL注入
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT * FROM users WHERE username = 'admin' OR '1'='1' --",
  "options": {
    "security": true,
    "performance": true,
    "standards": true
  }
}

### 测试UNION注入
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT * FROM users WHERE id = 1 UNION SELECT username, password, email FROM admin_users --",
  "options": {
    "security": true,
    "performance": true,
    "standards": true
  }
}

### 测试盲注
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT * FROM users WHERE id = 1 AND (SELECT COUNT(*) FROM information_schema.tables) > 0 --",
  "options": {
    "security": true,
    "performance": true,
    "standards": true
  }
}

### 测试时间盲注
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT * FROM users WHERE id = 1 AND (SELECT SLEEP(5)) --",
  "options": {
    "security": true,
    "performance": true,
    "standards": true
  }
}

### 测试堆叠查询注入
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT * FROM users WHERE id = 1; DROP TABLE users; --",
  "options": {
    "security": true,
    "performance": true,
    "standards": true
  }
}

### 5.2 XSS测试

### 测试XSS攻击向量
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT * FROM users WHERE name = '<script>alert(\"XSS\")</script>'",
  "options": {
    "security": true,
    "performance": true,
    "standards": true
  }
}

### 测试HTML注入
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT * FROM users WHERE comment = '<img src=x onerror=alert(\"XSS\")>'",
  "options": {
    "security": true,
    "performance": true,
    "standards": true
  }
}

### 5.3 其他安全测试

### 测试路径遍历
GET {{baseUrl}}/api/../../../etc/passwd

### 测试命令注入
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT * FROM users WHERE name = 'test; ls -la; echo'",
  "options": {
    "security": true,
    "performance": true,
    "standards": true
  }
}

### ========================================
### 6. 集成场景测试
### ========================================

### 6.1 完整分析工作流程

### 场景1: 完整的SQL分析流程
# 步骤1: 检查系统健康
GET {{baseUrl}}/api/health

###

# 步骤2: 分析SQL语句
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT u.*, COUNT(o.id) as order_count FROM users u LEFT JOIN orders o ON u.id = o.user_id WHERE u.status = 'active' GROUP BY u.id HAVING order_count > 5 ORDER BY order_count DESC",
  "options": {
    "performance": true,
    "security": true,
    "standards": true,
    "learn": true
  }
}

###

# 步骤3: 查看分析历史记录
GET {{baseUrl}}/api/history

###

# 步骤4: 获取历史记录统计
GET {{baseUrl}}/api/history/stats

### 6.2 知识库管理流程

### 场景2: 知识库学习和管理流程
# 步骤1: 获取知识库状态
GET {{baseUrl}}/api/knowledge

###

# 步骤2: 搜索相关知识
POST {{baseUrl}}/api/knowledge/search
Content-Type: {{contentType}}

{
  "query": "性能优化 索引设计",
  "k": 5
}

###

# 步骤3: 学习新文档
POST {{baseUrl}}/api/knowledge/learn
Content-Type: {{contentType}}

{
  "rulesDir": "./rules",
  "reset": false,
  "priorityApproved": true
}

###

# 步骤4: 评估规则质量
POST {{baseUrl}}/api/knowledge/evaluate
Content-Type: {{contentType}}

{
  "report": true,
  "rulesDir": "./rules/learning-rules"
}

###

# 步骤5: 导出知识库
GET {{baseUrl}}/api/knowledge/export?format=json&includeContent=true

### 6.3 批量分析场景

### 场景3: 批量SQL分析和管理
# 步骤1: 批量分析多条SQL
POST {{baseUrl}}/api/analyze/batch
Content-Type: {{contentType}}

{
  "sqls": [
    {"sql": "SELECT * FROM users WHERE email LIKE '%@example.com'"},
    {"sql": "SELECT product_name, SUM(quantity) as total_sold FROM order_items GROUP BY product_name ORDER BY total_sold DESC LIMIT 10"},
    {"sql": "UPDATE users SET last_login = NOW() WHERE id IN (SELECT user_id FROM orders WHERE created_at > '2025-01-01')"},
    {"sql": "DELETE FROM sessions WHERE expires_at < NOW()"},
    {"sql": "INSERT INTO audit_log (action, table_name, user_id) VALUES ('SELECT', 'users', 1)"}
  ],
  "options": {
    "performance": true,
    "security": true,
    "standards": true,
    "learn": false
  }
}

###

# 步骤2: 搜索特定类型的历史记录
POST {{baseUrl}}/api/history/search
Content-Type: {{contentType}}

{
  "sql": "UPDATE DELETE INSERT",
  "database": "mysql",
  "limit": 20
}

###

# 步骤3: 导出分析历史
GET {{baseUrl}}/api/history/export?format=csv

### 6.4 系统配置和管理

### 场景4: 系统配置和监控流程
# 步骤1: 获取系统状态
GET {{baseUrl}}/api/status

###

# 步骤2: 检查特定健康指标
GET {{baseUrl}}/api/health/check/memory

###

# 步骤3: 获取当前配置
GET {{baseUrl}}/api/config

###

# 步骤4: 修改配置
PUT {{baseUrl}}/api/config/logLevel
Content-Type: {{contentType}}

{
  "value": "debug"
}

###

# 步骤5: 验证配置修改
GET {{baseUrl}}/api/config/logLevel

###

# 步骤6: 重置配置
DELETE {{baseUrl}}/api/config/logLevel

### 6.5 错误恢复场景

### 场景5: 错误处理和恢复流程
# 步骤1: 触发错误 (无效SQL)
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "INVALID SQL SYNTAX",
  "options": {
    "performance": true,
    "security": true,
    "standards": true
  }
}

###

# 步骤2: 检查系统健康状态
GET {{baseUrl}}/api/health

###

# 步骤3: 执行正常操作验证系统恢复
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT COUNT(*) FROM users",
  "options": {
    "performance": true,
    "security": true,
    "standards": true
  }
}

### ========================================
### 测试完成
### ========================================

# 所有测试用例执行完毕
# 请检查响应结果，验证API功能是否正常
# 如有问题，请查看服务器日志获取详细错误信息

### ========================================
### 7. 新架构特定测试
### ========================================

### 7.1 新架构性能验证测试

### 测试新架构的LLM调用优化（单次调用多维度分析）
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT u.*, COUNT(o.id) as order_count FROM users u LEFT JOIN orders o ON u.id = o.user_id WHERE u.status = 'active' GROUP BY u.id HAVING order_count > 5 ORDER BY order_count DESC",
  "options": {
    "performance": true,
    "security": true,
    "standards": true,
    "learn": false
  }
}

### 测试新架构的缓存机制（重复相同查询）
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT u.*, COUNT(o.id) as order_count FROM users u LEFT JOIN orders o ON u.id = o.user_id WHERE u.status = 'active' GROUP BY u.id HAVING order_count > 5 ORDER BY order_count DESC",
  "options": {
    "performance": true,
    "security": true,
    "standards": true,
    "learn": false
  }
}

### 7.2 新架构响应格式验证

### 验证新架构的响应格式包含元数据
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT * FROM users WHERE id = 1",
  "options": {
    "performance": true,
    "security": true,
    "standards": true
  }
}

### 7.3 新架构错误处理测试

### 测试新架构的错误处理机制
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "INVALID SQL SYNTAX WITH NEW ARCHITECTURE",
  "options": {
    "performance": true,
    "security": true,
    "standards": true
  }
}

### 7.4 新架构批量分析测试

### 测试新架构的批量分析性能
POST {{baseUrl}}/api/analyze/batch
Content-Type: {{contentType}}

{
  "sqls": [
    {"sql": "SELECT * FROM users WHERE id = 1"},
    {"sql": "SELECT COUNT(*) FROM orders WHERE status = 'pending'"},
    {"sql": "UPDATE users SET last_login = NOW() WHERE id = 1"},
    {"sql": "DELETE FROM sessions WHERE expires_at < NOW()"},
    {"sql": "INSERT INTO audit_log (action, table_name, user_id) VALUES ('SELECT', 'users', 1)"}
  ],
  "options": {
    "performance": true,
    "security": true,
    "standards": true,
    "learn": false
  }
}

### 7.5 新架构学习功能测试

### 测试新架构的学习功能
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT u.*, o.order_id, o.total_amount FROM users u JOIN orders o ON u.id = o.user_id WHERE u.created_at > '2025-01-01'",
  "options": {
    "performance": true,
    "security": true,
    "standards": true,
    "learn": true
  }
}

### 7.6 新架构数据库识别测试

### 测试新架构的数据库类型识别
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT * FROM users LIMIT 10 OFFSET 20",
  "options": {
    "performance": true,
    "security": true,
    "standards": true
  }
}

### 测试PostgreSQL特定语法识别
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT * FROM users WHERE created_at > NOW() - INTERVAL '30 days'",
  "options": {
    "performance": true,
    "security": true,
    "standards": true
  }
}

### 测试MySQL特定语法识别
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT * FROM users WHERE created_at > DATE_SUB(NOW(), INTERVAL 30 DAY)",
  "options": {
    "performance": true,
    "security": true,
    "standards": true
  }
}

### ========================================
### 8. 验证修复问题的特定测试
### ========================================

### 8.1 数据库类型识别验证测试

### 测试简单SELECT语句的数据库类型识别（应该识别为mysql）
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT * FROM users WHERE id = 1",
  "options": {
    "performance": true,
    "security": true,
    "standards": true,
    "learn": false
  }
}

### 测试复杂查询的数据库类型识别
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT u.*, o.order_id FROM users u JOIN orders o ON u.id = o.user_id WHERE u.status = 'active'",
  "options": {
    "performance": true,
    "security": true,
    "standards": true,
    "learn": false
  }
}

### 测试PostgreSQL特定语法识别
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT * FROM users WHERE created_at > NOW() - INTERVAL '30 days'",
  "options": {
    "performance": true,
    "security": true,
    "standards": true,
    "learn": false
  }
}

### 测试MySQL特定语法识别
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT * FROM users WHERE created_at > DATE_SUB(NOW(), INTERVAL 30 DAY)",
  "options": {
    "performance": true,
    "security": true,
    "standards": true,
    "learn": false
  }
}

### 8.2 详细字段验证测试

### 验证性能分析详细字段
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT u.*, COUNT(o.id) as order_count FROM users u LEFT JOIN orders o ON u.id = o.user_id WHERE u.status = 'active' GROUP BY u.id HAVING order_count > 5 ORDER BY order_count DESC",
  "options": {
    "performance": true,
    "security": false,
    "standards": false,
    "learn": false
  }
}

### 验证安全分析详细字段
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT * FROM users WHERE username = 'admin' OR '1'='1' --",
  "options": {
    "performance": false,
    "security": true,
    "standards": false,
    "learn": false
  }
}

### 验证编码规范分析详细字段
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "select * from users where id = 1",
  "options": {
    "performance": false,
    "security": false,
    "standards": true,
    "learn": false
  }
}

### 验证全维度分析详细字段
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT u.*, o.order_id, o.total_amount FROM users u INNER JOIN orders o ON u.id = o.user_id WHERE u.status = 'active' AND o.created_at >= '2025-01-01' ORDER BY u.created_at DESC LIMIT 100",
  "options": {
    "performance": true,
    "security": true,
    "standards": true,
    "learn": false
  }
}

### 8.3 历史记录字段验证

### 执行分析后检查历史记录中的详细字段
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT u.name, COUNT(o.id) as order_count, SUM(o.total) as total_spent FROM users u LEFT JOIN orders o ON u.id = o.user_id WHERE u.register_date >= '2025-01-01' GROUP BY u.id, u.name HAVING COUNT(o.id) > 3 ORDER BY total_spent DESC LIMIT 50",
  "options": {
    "performance": true,
    "security": true,
    "standards": true,
    "learn": false
  }
}

###

### 检查最新历史记录是否包含详细字段
GET {{baseUrl}}/api/history

###

### 获取历史记录统计信息
GET {{baseUrl}}/api/history/stats

### 8.4 提示词文件加载验证

### 测试性能分析提示词加载
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT * FROM large_table WHERE complex_condition = 'value' ORDER BY created_at DESC LIMIT 1000",
  "options": {
    "performance": true,
    "security": false,
    "standards": false,
    "learn": false
  }
}

### 测试安全审计提示词加载
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT * FROM users WHERE id = " + "1 UNION SELECT username, password FROM admin --",
  "options": {
    "performance": false,
    "security": true,
    "standards": false,
    "learn": false
  }
}

### 测试编码规范检查提示词加载
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT * FROM users WHERE name = 'test' and status=1",
  "options": {
    "performance": false,
    "security": false,
    "standards": true,
    "learn": false
  }
}

### 8.5 错误恢复和边界情况测试

### 测试空SQL语句的错误处理
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "",
  "options": {
    "performance": true,
    "security": true,
    "standards": true,
    "learn": false
  }
}

### 测试无效SQL语法的错误处理
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELCT * FORM users WHER id = 1",
  "options": {
    "performance": true,
    "security": true,
    "standards": true,
    "learn": false
  }
}

### 测试缺少options参数的处理
POST {{baseUrl}}/api/analyze
Content-Type: {{contentType}}

{
  "sql": "SELECT * FROM users WHERE id = 1"
}

### ========================================
### 修复验证测试完成
### ========================================