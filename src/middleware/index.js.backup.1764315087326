/**
 * 中间件索引文件
 * 统一导出所有中间件
 */

import { createDefaultCorsMiddleware } from './cors.js';
import { createDefaultRequestLoggerMiddleware } from './request-logger.js';
import { createDefaultRateLimiterMiddleware, createAnalysisRateLimiterMiddleware } from './rate-limiter.js';
import { createDefaultErrorHandlerMiddleware, notFoundHandlerMiddleware } from './error-handler.js';
import { createDefaultAuthMiddleware, createAdminAuthMiddleware } from './auth.js';
import { ApiError, ErrorTypes, createValidationError, createNotFoundError, createExternalError } from '../utils/api/api-error.js';

/**
 * 创建默认中间件链
 * @returns {Array} 中间件数组
 */
function createDefaultMiddlewareChain() {
  return [
    createDefaultCorsMiddleware(),
    createDefaultRateLimiterMiddleware(),
    createDefaultRequestLoggerMiddleware(),
    createDefaultErrorHandlerMiddleware()
  ];
}

/**
 * 创建分析API专用中间件链
 * @returns {Array} 中间件数组
 */
function createAnalysisMiddlewareChain() {
  return [
    createDefaultCorsMiddleware(),
    createAnalysisRateLimiterMiddleware(),
    createDefaultRequestLoggerMiddleware(),
    createDefaultErrorHandlerMiddleware()
  ];
}

/**
 * 创建管理API专用中间件链
 * @returns {Array} 中间件数组
 */
function createAdminMiddlewareChain() {
  return [
    createDefaultCorsMiddleware(),
    createDefaultRateLimiterMiddleware(),
    createDefaultRequestLoggerMiddleware(),
    createDefaultErrorHandlerMiddleware()
  ];
}

// 导出所有中间件
export {
  // CORS中间件
  createDefaultCorsMiddleware,

  // 认证中间件
  createDefaultAuthMiddleware,
  createAdminAuthMiddleware,

  // 请求日志中间件
  createDefaultRequestLoggerMiddleware,

  // 限流中间件
  createDefaultRateLimiterMiddleware,
  createAnalysisRateLimiterMiddleware,

  // 错误处理中间件
  createDefaultErrorHandlerMiddleware,
  notFoundHandlerMiddleware,

  // 中间件链
  createDefaultMiddlewareChain,
  createAnalysisMiddlewareChain,
  createAdminMiddlewareChain,

  // 导出中间件类和工具函数
  ApiError,
  ErrorTypes,
  createValidationError,
  createNotFoundError,
  createExternalError
};