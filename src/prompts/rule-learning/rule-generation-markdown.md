# SQL规则生成器 - Markdown版本

基于SQL分析结果生成Markdown格式的知识库文档。

## 输入参数
- `{{sqlQuery}}`: SQL查询语句
- `{{analysisResult}}`: 分析结果(JSON)
- `{{databaseType}}`: 数据库类型
- `{{existingRules}}`: 现有规则(可选)

## 规则生成标准

### 1. 规则信息要求
每个规则必须包含：
- **标题**: 简洁明确的规则名称(≤30字)
- **分类**: performance|security|standards
- **严重程度**: critical|high|medium|low
- **触发条件**: 明确的检测条件
- **问题描述**: 50-100字详细说明
- **影响说明**: 具体业务或技术影响
- **修复建议**: 30-60字具体可行的建议
- **示例代码**: 错误和正确的SQL代码对比
- **置信度**: 0.0-1.0的数值

### 2. 优先级标准
- **🔴 Critical**: SQL注入、数据泄露、权限绕过等严重安全风险
- **🟠 High**: 索引缺失、全表扫描、性能瓶颈等严重性能问题
- **🟡 Medium**: JOIN优化、格式问题、编码规范等中等问题
- **🟢 Low**: 命名规范、注释缺失、代码风格等轻微问题

### 3. 质量要求
- 基于实际分析证据，不凭空猜测
- 触发条件必须可程序检测
- 建议要具体可实施，技术上可行
- 避免与现有规则重复
- 代码示例要真实有效

## 输出格式要求

请直接输出Markdown格式的知识库文档，结构如下：

```markdown
# 自动生成的SQL分析规则

> 🚀 **生成时间**: [当前时间]
> 🤖 **生成方式**: 基于历史记录的LLM智能学习
> 📊 **规则总数**: [规则数量]

## 📋 规则概览

### 📈 统计信息
- **总数**: [总数] 条规则
- **分类分布**:
  - 性能优化: [数量] 条
  - 安全检查: [数量] 条
  - 规范标准: [数量] 条
- **严重程度分布**:
  - 🔴 严重: [数量] 条
  - 🟠 高危: [数量] 条
  - 🟡 中等: [数量] 条
  - 🟢 低危: [数量] 条

## 🔴 严重级别规则

[严重级别规则的详细内容...]

## 🟠 高危级别规则

[高危级别规则的详细内容...]

## 🟡 中等级别规则

[中等级别规则的详细内容...]

## 🟢 低危级别规则

[低危级别规则的详细内容...]

## 🔧 使用说明

这些规则是通过分析历史SQL查询自动生成的，可以用于：

1. **性能优化**: 识别慢查询和低效SQL模式
2. **安全检查**: 发现潜在的安全漏洞和风险
3. **规范检查**: 确保SQL代码符合团队编码标准

## 📚 相关信息

- 规则会定期基于新的分析结果进行更新
- 可以通过 `sql-analyzer learn` 命令手动触发规则学习
- 生成的规则会自动集成到SQL分析流程中

---
*此文档由SQL分析器自动生成，请勿手动编辑*
```

## 规则详细内容模板

每个规则包含以下内容：

```markdown
### [序号]. [图标] [规则标题]

**基本信息**:
- **规则ID**: `[唯一标识符]`
- **分类**: [performance|security|standards] ([图标])
- **严重程度**: [critical|high|medium|low]
- **置信度**: [百分比]%
- **触发条件**: `[明确的检测条件]`

**详细描述**:
[50-100字的问题描述]

**示例**:
```sql
-- 错误示例
[具体的错误SQL代码]

-- 正确示例
[正确的SQL代码]
```

**修复建议**:
[30-60字的具体修复建议]

**学习来源**: 基于历史SQL分析结果自动生成

---
```

## 分类图标规范
- **性能优化**: ⚡
- **安全检查**: 🛡️
- **规范标准**: 📋

## 生成策略

### 性能规则 (⚡)
- 索引缺失 → 建议添加索引提升查询速度
- SELECT * → 建议指定字段减少数据传输
- 前导通配符 → 建议全文索引或改写查询
- 大表无WHERE → 建议添加WHERE条件限制范围
- 深度分页 → 建议使用游标或ID分页
- 相关子查询 → 建议改为JOIN查询

### 安全规则 (🛡️)
- 动态SQL拼接 → 建议参数化查询防注入
- 权限绕过 → 建议严格权限控制
- 敏感数据暴露 → 建议字段脱敏或加密
- 明文密码 → 建议使用加密存储
- SQL注入 → 建议输入验证和参数化查询

### 规范规则 (📋)
- 命名不规范 → 建议统一命名规范
- 缺少注释 → 建议添加业务说明注释
- 格式混乱 → 建议使用SQL格式化工具
- 关键字大小写 → 建议统一关键字大写

## 注意事项
1. 只基于实际分析结果生成规则，不要凭空创造
2. 每个问题类型最多生成1条规则避免重复
3. 触发条件要具体明确，便于程序检测
4. 建议要技术可行，有实际操作价值
5. 代码示例要真实，能说明问题
6. 保持规则标题简洁明确，便于理解

基于提供的分析结果，直接输出完整的Markdown格式SQL分析规则文档。