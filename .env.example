# ===========================================
# SQL Analyzer API 环境变量配置示例
# ===========================================

# 基础配置
# ===========================================
# 运行环境 (development|production)
NODE_ENV=development

# API 服务器配置
API_HOST=0.0.0.0
API_PORT=3000

# 日志配置
LOG_LEVEL=info                    # debug|info|warn|error
LOG_REQUEST_BODY=false             # 是否记录请求体（生产环境建议设为false）
LOG_FILE_PATH=./logs/api.log      # 日志文件路径

# CORS 配置
CORS_ENABLED=true
CORS_ORIGIN=*                   # 或指定域名：https://example.com

# 限流配置
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS=100          # 每个时间窗口的请求数
RATE_LIMIT_WINDOW=900000          # 时间窗口（毫秒），15分钟

# 安全配置
API_KEY_REQUIRED=false            # 是否需要 API 密钥认证
API_KEY=your-secret-key          # API 密钥（如果启用认证）

# ===========================================
# LLM 服务配置
# ===========================================

# 自定义API基础URL
CUSTOM_BASE_URL=https://api.openai.com/v1

# API密钥
CUSTOM_API_KEY=your_api_key_here

# 模型名称
CUSTOM_MODEL=deepseek-ai/DeepSeek-V3.1

# 嵌入模型名称
CUSTOM_EMBEDDING_MODEL=BAAI/bge-m3

# ===========================================
# 向量存储配置
# ===========================================

# 向量存储API密钥（如果不设置，将使用CUSTOM_API_KEY）
VECTOR_STORE_API_KEY=

# 向量存储基础URL（如果不设置，将使用CUSTOM_BASE_URL）
VECTOR_STORE_BASE_URL=

# 向量存储嵌入模型（如果不设置，将使用CUSTOM_EMBEDDING_MODEL）
VECTOR_STORE_EMBEDDING_MODEL=

# ===========================================
# 数据库配置（可选）
# ===========================================

# PostgreSQL 配置（如果使用外部数据库）
DATABASE_URL=postgresql://user:password@localhost:5432/sql_analyzer

# Redis 配置（可选，用于缓存）
REDIS_URL=redis://localhost:6379
REDIS_PASSWORD=

# ===========================================
# 监控配置
# ===========================================

# 健康检查配置
HEALTH_CHECK_ENABLED=true

# 指标收集配置
METRICS_ENABLED=false             # 是否启用指标收集
METRICS_PORT=9090               # 指标端口

# ===========================================
# 性能优化配置
# ===========================================

# 缓存配置
CACHE_ENABLED=false               # 是否启用缓存
CACHE_TTL=3600                  # 缓存过期时间（秒）

# 连接池配置
DB_POOL_MAX=20                  # 数据库连接池最大连接数
DB_POOL_IDLE_TIMEOUT=30000        # 连接池空闲超时（毫秒）

# ===========================================
# 开发环境特定配置
# ===========================================

# 热重载（仅开发环境）
HOT_RELOAD=true

# 调试模式
DEBUG=false

# ===========================================
# 生产环境特定配置
# ===========================================

# 集群配置
CLUSTER_MODE=false               # 是否启用集群模式
WORKER_THREADS=4                # 工作线程数

# 内存限制
NODE_OPTIONS=--max-old-space-size=2048

# ===========================================
# SSL/TLS 配置（可选）
# ===========================================

# HTTPS 配置
HTTPS_ENABLED=false
SSL_CERT_PATH=/path/to/certificate.crt
SSL_KEY_PATH=/path/to/private.key

# ===========================================
# 第三方服务集成（可选）
# ===========================================

# Webhook 配置
WEBHOOK_ENABLED=false
WEBHOOK_URL=https://your-webhook-endpoint.com/api/events
WEBHOOK_SECRET=your-webhook-secret

# 通知配置
NOTIFICATION_ENABLED=false
NOTIFICATION_EMAIL=admin@example.com
NOTIFICATION_WEBHOOK=https://notifications.example.com/webhook

# ===========================================
# 备份配置
# ===========================================

# 自动备份
BACKUP_ENABLED=false
BACKUP_INTERVAL=86400          # 备份间隔（秒），24小时
BACKUP_RETENTION_DAYS=30         # 备份保留天数
BACKUP_PATH=./backups            # 备份存储路径

# ===========================================
# 高级配置
# ===========================================

# 请求超时
REQUEST_TIMEOUT=30000            # 请求超时时间（毫秒）

# 最大请求大小
MAX_REQUEST_SIZE=10485760        # 最大请求体大小（字节），10MB

# 并发限制
MAX_CONCURRENT_REQUESTS=100       # 最大并发请求数

# ===========================================
# 示例配置组合
# ===========================================

# 开发环境示例
# NODE_ENV=development
# API_HOST=localhost
# API_PORT=3000
# LOG_LEVEL=debug
# LOG_REQUEST_BODY=true
# HOT_RELOAD=true

# 生产环境示例
# NODE_ENV=production
# API_HOST=0.0.0.0
# API_PORT=3000
# LOG_LEVEL=warn
# LOG_REQUEST_BODY=false
# CORS_ENABLED=true
# CORS_ORIGIN=https://yourdomain.com
# RATE_LIMIT_ENABLED=true
# RATE_LIMIT_REQUESTS=100
# RATE_LIMIT_WINDOW=900000
# API_KEY_REQUIRED=true
# API_KEY=your-secure-random-key-here
# CLUSTER_MODE=true
# WORKER_THREADS=4
# BACKUP_ENABLED=true
# METRICS_ENABLED=true

# ===========================================
# 配置说明
# ===========================================

# 1. 复制此文件为 .env
# cp .env.example .env

# 2. 根据实际环境修改配置值
# nano .env

# 3. 确保敏感信息（如API密钥）不提交到版本控制
# echo ".env" >> .gitignore

# 4. 重启服务以应用新配置
# docker-compose restart sql-analyzer-api
# 或
# pm2 restart sql-analyzer-api

# ===========================================
# 安全注意事项
# ===========================================

# 1. 不要在代码中硬编码敏感信息
# 2. 使用环境变量或密钥管理服务
# 3. 在生产环境中使用强密码和随机API密钥
# 4. 定期轮换API密钥
# 5. 限制CORS源到可信域名
# 6. 启用请求限流防止滥用

# ===========================================
# 故障排除
# ===========================================

# 如果服务无法启动，检查：
# 1. 端口是否被占用：netstat -tlnp | grep :3000
# 2. 环境变量是否正确：cat .env
# 3. 日志文件权限：ls -la logs/
# 4. 依赖是否安装：bun list

# 如果API调用失败，检查：
# 1. API密钥是否正确
# 2. 网络连接是否正常
# 3. LLM服务是否可用
# 4. 请求格式是否正确